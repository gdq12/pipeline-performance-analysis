{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.3", "generated_at": "2025-03-26T16:48:18.741734Z", "invocation_id": "a31048ab-afe2-4c94-8df4-8c53822ecc73", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-26T16:45:21.163634Z", "completed_at": "2025-03-26T16:45:21.239482Z"}, {"name": "execute", "started_at": "2025-03-26T16:45:21.241027Z", "completed_at": "2025-03-26T16:45:22.711414Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.552466869354248, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "pipeline-analysis-452722", "job_id": "dc63d2ea-c4f0-44ea-a262-f347e8c0bd3f", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.pipeline_analysis_transform.stg_yellow__1a_id_duplicate_records", "compiled": true, "compiled_code": "\n\nselect \n  pickup_datetime, dropoff_datetime, ratecode_id, pickup_location_id, dropoff_location_id, passenger_count, trip_distance\n  , count(1) row_count\n  , sum(fare_amount) total_fare_amount\nfrom `pipeline-analysis-452722`.`nytaxi_clean`.`yellow__4_adds_columns`\ngroup by pickup_datetime, dropoff_datetime, ratecode_id, pickup_location_id, dropoff_location_id, passenger_count, trip_distance", "relation_name": "`pipeline-analysis-452722`.`nytaxi_stage2`.`stg_yellow__1a_id_duplicate_records`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-26T16:45:21.209747Z", "completed_at": "2025-03-26T16:45:21.260094Z"}, {"name": "execute", "started_at": "2025-03-26T16:45:21.267092Z", "completed_at": "2025-03-26T16:45:22.803232Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 1.6431021690368652, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "pipeline-analysis-452722", "job_id": "0b35e1d4-0789-45c6-9d2f-6e0047ad79e5", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.pipeline_analysis_transform.stg_yellow__1b_id_faulty_trips", "compiled": true, "compiled_code": "\n\nselect data_source, trip_id\nfrom `pipeline-analysis-452722`.`nytaxi_clean`.`yellow__4_adds_columns`\nwhere (\n      -- invalid trip timestamps\n      (pickup_datetime >= dropoff_datetime)\n      or \n      -- trip timestamps not inline with source parquet\n      (pickup_datetime < cast(trip_type_start_date as timestamp))\n      or \n      -- trips with unknown pickup or dropoff location\n      (pickup_location_id = 264 or dropoff_location_id = 264)\n      or \n      -- trip with airport fee but location not at airport \n      (coalesce(airport_fee, 0) > 0 and regexp_substr(pickup_location_id||' - '||dropoff_location_id, '138|132') is null)\n      or \n      -- fare amount negative but payment_type not void, dispute or no charge\n      (fare_amount <= 0 and payment_type not in (3, 4, 6) and trip_type_start_date >= '2022-05-01')\n      or \n      -- all trips must report some distance to be valid\n      (trip_distance < 0)\n      or \n      -- trips where charges dont add up\n      (abs(total_amount) - abs(fare_amount+extra_amount+mta_tax+tip_amount+tolls_amount+improvement_surcharge+congestion_surcharge+airport_fee) > 1)\n      or \n      -- trips with non-JFK destination but got the rate charge\n      (coalesce(ratecode_id, 0) in (2, 0) and regexp_substr(pickup_location_id||' - '||dropoff_location_id, '132') is null and trip_type_start_date >= '2022-05-01')\n      or  \n      -- trips with non-Newark destination but got the rate charge\n      (coalesce(ratecode_id, 0) in (3, 0) and regexp_substr(pickup_location_id||' - '||dropoff_location_id, '^1 - | - 1$') is null and trip_type_start_date >= '2022-05-01')\n      or \n      -- trips tip with outer city rate but locations not outside the city\n      (coalesce(ratecode_id, 0) in (4, 0) and regexp_substr(pickup_location_id||' - '||dropoff_location_id, '265') is null and trip_type_start_date >= '2022-05-01')\n      or \n      -- rows that dont have valid passenger count (either 0 or over the legal limit for a single ride)\n      (passenger_count > 6 or passenger_count <= 0)\n      -- all trips with a positive trip amount should have a cc ratecode ID\n      or  \n      (tip_amount > 0 and payment_type != 1 and trip_type_start_date >= '2022-05-01')\n)", "relation_name": "`pipeline-analysis-452722`.`nytaxi_stage2`.`stg_yellow__1b_id_faulty_trips`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-26T16:45:22.816858Z", "completed_at": "2025-03-26T16:45:22.829059Z"}, {"name": "execute", "started_at": "2025-03-26T16:45:22.830431Z", "completed_at": "2025-03-26T16:45:24.080011Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 1.266826868057251, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "pipeline-analysis-452722", "job_id": "77bb5664-2c88-421c-8ad6-baca3e7703bc", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.pipeline_analysis_transform.stg_yellow__2_filter_out_faulty", "compiled": true, "compiled_code": "select \n  tbl.trip_id,\n  tbl.vendor_id,\n  tbl.pickup_datetime,\n  tbl.dropoff_datetime,\n  tbl.passenger_count,\n  tbl.trip_distance,\n  tbl.pickup_location_id,\n  tbl.ratecode_id,\n  tbl.store_and_fwd_flag,\n  tbl.dropoff_location_id,\n  tbl.payment_type,\n  tbl.fare_amount,\n  tbl.extra_amount,\n  tbl.mta_tax,\n  tbl.tip_amount,\n  tbl.tolls_amount,\n  tbl.improvement_surcharge,\n  tbl.total_amount,\n  tbl.congestion_surcharge,\n  tbl.airport_fee,\n  tbl.pickup_date,\n  tbl.trip_type,\n  tbl.trip_type_start_date,\n  tbl.trip_type_end_date,\n  tbl.data_source,\n  tbl.creation_dt\nfrom `pipeline-analysis-452722`.`nytaxi_clean`.`yellow__4_adds_columns` tbl\nleft join `pipeline-analysis-452722`.`nytaxi_stage2`.`stg_yellow__1b_id_faulty_trips` ft1 on tbl.data_source = ft1.data_source \n                                                    and tbl.trip_id = ft1.trip_id\nleft join `pipeline-analysis-452722`.`nytaxi_stage2`.`stg_yellow__1a_id_duplicate_records` ft2 on tbl.pickup_datetime = ft2.pickup_datetime\n                                                        and tbl.dropoff_datetime = ft2.dropoff_datetime\n                                                        and coalesce(tbl.ratecode_id, 0) = coalesce(ft2.ratecode_id, 0)\n                                                        and tbl.pickup_location_id = ft2.pickup_location_id \n                                                        and tbl.dropoff_location_id = ft2.dropoff_location_id \n                                                        and tbl.passenger_count = ft2.passenger_count\n                                                        and tbl.trip_distance = ft2.trip_distance \n                                                        and ft2.row_count = 2\n                                                        and ft2.total_fare_amount = 0\n                                                        and tbl.fare_amount < 0\nwhere ft1.data_source is null and ft2.pickup_location_id is null", "relation_name": "`pipeline-analysis-452722`.`nytaxi_stage2`.`stg_yellow__2_filter_out_faulty`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-26T16:45:24.088292Z", "completed_at": "2025-03-26T16:45:24.106257Z"}, {"name": "execute", "started_at": "2025-03-26T16:45:24.107566Z", "completed_at": "2025-03-26T16:48:18.709081Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 174.62430453300476, "adapter_response": {"_message": "CREATE TABLE (1.6b rows, 383.3 GiB processed)", "code": "CREATE TABLE", "rows_affected": 1648566991, "bytes_processed": 411590881945, "bytes_billed": 411591245824, "location": "EU", "project_id": "pipeline-analysis-452722", "job_id": "6f085b3b-ccc6-47df-977d-3759de35e81c", "slot_ms": 307942420}, "message": "CREATE TABLE (1.6b rows, 383.3 GiB processed)", "failures": null, "unique_id": "model.pipeline_analysis_transform.stg_yellow__3_from_source_clean", "compiled": true, "compiled_code": "\n\nselect \n  -- IDs\n  trip_id,\n  vendor_id,\n  -- time centric dimensions \n  pickup_datetime,\n  dropoff_datetime,\n  trip_type_start_date,\n  trip_type_end_date,\n  pickup_date,\n  -- more time dimensions for later analysis \n  \n\n    datetime_diff(\n        cast(dropoff_datetime as datetime),\n        cast(pickup_datetime as datetime),\n        minute\n    )\n\n   trip_duration_min,\n  extract(year from pickup_datetime) pickup_year,\n  extract(dayofweek from pickup_datetime) pickup_weekday_num,\n  extract(week from pickup_datetime) pickup_calender_week_num,\n  extract(month from pickup_datetime) pickup_month,\n  extract(hour from pickup_datetime) pickup_hour,\n  bigfunctions.eu.is_public_holiday(cast(pickup_datetime as date), 'US') pickup_public_holiday,\n  extract(year from dropoff_datetime) dropoff_year,\n  extract(dayofweek from dropoff_datetime) dropoff_weekday_num,\n  extract(week from dropoff_datetime) dropoff_calender_week_num,\n  extract(month from dropoff_datetime) dropoff_month,\n  extract(hour from dropoff_datetime) dropoff_hour,\n  bigfunctions.eu.is_public_holiday(cast(dropoff_datetime as date), 'US') dropoff_public_holiday,\n  -- location centric info \n  pickup_location_id,\n  dropoff_location_id,\n  -- trip categorization\n  ratecode_id,\n  store_and_fwd_flag,\n  payment_type,\n  -- for unit centric calculations\n  passenger_count,\n  trip_distance,\n  -- revenue centric stats\n  fare_amount,\n  extra_amount,\n  mta_tax,\n  tip_amount,\n  tolls_amount,\n  improvement_surcharge,\n  total_amount,\n  congestion_surcharge,\n  airport_fee,\n  -- data source centric info\n  trip_type,\n  data_source,\n  creation_dt,\n  current_timestamp() transformation_dt\nfrom `pipeline-analysis-452722`.`nytaxi_stage2`.`stg_yellow__2_filter_out_faulty`", "relation_name": "`pipeline-analysis-452722`.`nytaxi_stage2`.`stg_yellow__3_from_source_clean`", "batch_results": null}], "elapsed_time": 181.3346552848816, "args": {"invocation_command": "dbt run --select models/stage/yellow/", "skip_nodes_if_on_run_start_fails": false, "require_resource_names_without_spaces": false, "quiet": false, "use_colors": true, "log_format_file": "debug", "project_dir": "/workspaces/pipeline-performance-analysis/2_transformation_dbt", "select": ["models/stage/yellow/"], "macro_debugging": false, "log_file_max_bytes": 10485760, "require_explicit_package_overrides_for_builtin_materializations": true, "static_parser": true, "log_format": "default", "empty": false, "require_nested_cumulative_type_params": false, "state_modified_compare_vars": false, "introspect": true, "require_yaml_configuration_for_mf_time_spines": false, "strict_mode": false, "require_batched_execution_for_custom_microbatch_strategy": false, "warn_error_options": {"include": [], "exclude": []}, "show_resource_report": false, "indirect_selection": "eager", "log_path": "/workspaces/pipeline-performance-analysis/2_transformation_dbt/logs", "use_colors_file": true, "partial_parse_file_diff": true, "cache_selected_only": false, "favor_state": false, "profiles_dir": "/workspaces/pipeline-performance-analysis/2_transformation_dbt", "write_json": true, "version_check": true, "state_modified_compare_more_unrendered_values": false, "source_freshness_run_project_hooks": false, "log_level": "info", "printer_width": 80, "print": true, "populate_cache": true, "exclude": [], "send_anonymous_usage_stats": true, "partial_parse": true, "defer": false, "vars": {}, "log_level_file": "debug", "which": "run"}}